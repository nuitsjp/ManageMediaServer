# 開発TODO

## フェーズ1: 基盤構築 🏗️ ✅ **完了**

### 必須（高優先度）
- [x] **統合セットアップスクリプト作成** ✅ **完了**
- [x] **物理ディレクトリ差分吸収機構** ✅ **完了**
- [x] **Docker設定作成** ✅ **完了**
- [x] **基本設定ファイル** ✅ **完了**

### 推奨（中優先度）
- [ ] **ドキュメント統合**
  - [ ] `docs/setup/environment-setup.md` - 統合セットアップガイド作成
  - [ ] **環境変数管理ガイド追加** - 物理パス設定方法の説明
  - [ ] 既存の`development-environment.md`の統合または削除判断

- [ ] **基本運用スクリプト**
  - [ ] `scripts/rclone/sync-photos.sh` - 画像同期スクリプト
  - [ ] `scripts/rclone/sync-videos.sh` - 動画同期スクリプト
  - [ ] `scripts/backup/backup-media.sh` - メディアバックアップスクリプト

## フェーズ2: 開発環境検証 🧪 ✅ **完了**

### 必須
- [x] **WSL開発環境での動作確認** ✅ **完了**
- [x] **統合Docker構造への移行** ✅ **完了**
- [x] **.env自動生成システム** ✅ **完了**
- [x] **サービス起動テストの成功** ✅ **完了**
- [x] **開発用便利スクリプト** ✅ **完了**

## フェーズ3: 本番環境対応 🚀

### 必須
- [x] **セキュリティ設定** ✅ **完全実装完了**
  - [x] ファイアウォール設定の自動化 ✅ **完了** (UFW設定、家庭内ネットワーク制限適用済み)
  - [x] ユーザー権限設定の自動化 ✅ **完了** (mediaserverユーザー、docker権限設定済み)
  - [x] SSH設定の強化 ✅ **完了** (fail2ban設定適用、SSH攻撃防止機能稼働中)
  - [x] セキュリティテスト機能 ✅ **完了** (auto-setup.sh --test-mode実装済み)
  - [x] セキュリティ検証システム ✅ **完了** (security-check.sh動作確認済み)

### 推奨
- [ ] **運用自動化**
  - [ ] `scripts/prod/deploy.sh` - 本番デプロイスクリプト
  - [ ] `scripts/maintenance/update-system.sh` - システム更新スクリプト
  - [ ] `scripts/monitoring/health-check.sh` - ヘルスチェックスクリプト

## フェーズ4: 外部連携・高度機能 🌐

### 必須
- [ ] **Cloudflare連携**
  - [ ] Cloudflare Tunnel設定
  - [ ] Cloudflare Access設定
  - [ ] 外部アクセステスト

- [ ] **rclone実運用設定**
  - [ ] Google Photos連携設定
  - [ ] OneDrive連携設定
  - [ ] 定期同期の動作確認

### 推奨
- [ ] **監視・ログ**
  - [ ] ログローテーション設定
  - [ ] ディスク使用量監視
  - [ ] エラー通知機能

## フェーズ5: ドキュメント・保守性向上 📚

### 推奨
- [ ] **運用ドキュメント**
  - [ ] `docs/operations/README.md` - 運用ガイド
  - [ ] `docs/operations/backup-procedures.md` - バックアップ手順
  - [ ] `docs/operations/troubleshooting.md` - トラブルシューティング

- [ ] **保守性向上**
  - [ ] 設定ファイルのバリデーション機能
  - [ ] セットアップスクリプトのエラーハンドリング強化
  - [ ] ロールバック機能の実装

## 進捗管理

### 現在のフェーズ
- 🎯 **フェーズ3: 本番環境対応** (セキュリティ設定完了、残り運用自動化)

### 次のマイルストーン
- 🚀 **フェーズ4: 外部連携・高度機能**

### 完了済み
- ✅ システム設計・アーキテクチャ設計
- ✅ ドキュメント構造設計
- ✅ 統一構成方針決定
- ✅ **フェーズ1: 基盤構築** (**100%完了!** 🎉)
- ✅ **フェーズ2: 開発環境検証** (**100%完了!** 🎉)
- ✅ **フェーズ3: セキュリティ設定** (**100%完了!** 🔒)

### 直近の優先タスク（今週）
1. 🎯 **フェーズ3完了: 運用自動化**
   - [ ] 本番Ubuntu Server環境でのセキュリティ設定完全テスト
   - [ ] コンテナサービス起動問題の解決
   - [ ] deploy.sh、update-system.sh、health-check.sh運用スクリプト作成
   - [ ] ディスク構成・マウント設定の自動化検証
   - [ ] systemdサービス登録・起動確認

2. 📝 **ドキュメント更新**
   - [ ] Phase 2完了に伴う各種ドキュメント更新
   - [ ] 統合Docker構造の運用ガイド作成

### Phase 2完了成果 🎉
- **統合Docker構造**: dev/prod分離を廃止し、docker/immich/とdocker/jellyfin/の統合構造に移行完了
- **.env自動生成**: .env.exampleテンプレートからの動的環境設定生成システム実装完了
- **WSL開発環境**: Docker Compose v2対応、権限問題解決、実地テスト成功
- **サービス動作確認**: Immich(localhost:2283)、Jellyfin(localhost:8096)両サービス正常動作確認完了
- **開発用スクリプト**: start/stop/reset便利スクリプト実装・テスト完了

### Phase 3セキュリティ実装完了成果 🔒
- **UFWファイアウォール**: 家庭内ネットワーク制限（192.168.0.0/16）設定、SSH/Immich/Jellyfin ポート適切な許可設定完了
- **fail2ban侵入防止**: SSH攻撃検出・ブロック機能稼働、家庭内IP除外設定適用済み
- **auto-setup強化**: --test-mode、--security-onlyオプション実装、WSL環境対応完了
- **セキュリティ検証**: security-check.shによる自動状態確認機能実装・動作確認完了
- **パッケージ管理**: システムパッケージ（ufw, fail2ban）自動インストール機能実装完了

### 注意事項・メモ
- 開発環境と本番環境の論理構成統一を最優先
- **物理パス差分は環境変数で完全吸収** ⭐ 重要方針（詳細は[SCRIPT_DESIGN.md](SCRIPT_DESIGN.md#物理パス差分吸収)参照）
- セットアップスクリプトは冪等性を保つ
- エラーハンドリングは後回しにせず、最初から組み込む
- 設定ファイルはテンプレート化し、機密情報は環境変数で管理
